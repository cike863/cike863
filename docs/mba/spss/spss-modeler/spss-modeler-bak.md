# 1：SPSS Modeler 基本介绍

## 简介

SPSS最初称为“Statistical Package for the Social Sciences"，即社会科学统计软件包。1968年，SPSS由斯坦福3个学生所开发，它是世界上最早的统计分析软件。在1984年，SPSS公司推出全球第个统计分析软件微机版本(SPSS/PC+)，并使其能很快地应用于自然科学、技术科学、社会科学的各个领域。之后在1999年，SPSS公司收购了Clementine产品线，并将其改名为SPSS Modeler。随着这次收购，以及SPSS产品能力和服务范围的扩
展，SPSS公司将英文全称改为Statistical Product and Service Solutions, 即统计产品与服务解决方案，这也标志着公司战略方向和产品设计的重大转型。在2009年，SPSS公司被IBM收购，而直到现在，IBMSPSS产品线下最主要的两款产品依然为IBMSPSSStatistics以及IBM SPSS Modeler,前者定位于为统计分析工具，后者则定位为数据挖掘工具。

## 特点

- 专业性
  - 覆盖整个数据挖掘的生命周期
    - 数据处理
    - 分析探索
    - 模型创建
    - 评估及部署
  - 高效的流程处理
    - 数据合并
    - 数据导出
    - 数据筛选
    - 数据汇总
    - 。。。
  - 丰富、稳健的数据挖掘模型
    - 分类算法
    - 距离算法
    - 。。。。
- 易用性
  - 图形化界面
  - 自动建模算法
  - 便捷的参数调整
- 拓展性
  - 集成多重数据源
  - 
- 高性能

## CRISP-DM方法论

- 商业理解

  在数据收集及建立模型之前，应该先完成对商业目标的界定。在这个阶段，需要与相关业务及技术人员对
  数据挖掘目标的达成、对现有资源的评估及对计划的制定进行充分讨论。商业理解阶段是整个数据挖掘过程路线图的基础所在。在商业理解阶段，需要完成以下工作:

  - 确定业务目标
  - 评估情况
  - 确定数据挖掘目标
  - 指定项目计划

- 数据理解

  在数据理解阶段，需要深入理解可用于数据挖掘项目的相关数据资源。只有完成对数据资源的充分掌握，才能避免在下一-阶段 (数据准备)中发生意外问题，因此可以利用表格、图形或统计指标对数据进行进一步 的数据探索。在数据理解阶段，需要完成以下工作:

  - 收集准备原始数据
  - 描述数据
  - 探索数据
  - 验证数据质量

- 数据准备

  在数据准备阶段，需要花费大量的时间对数据进行清洗，以保证在建模时具备高质量的数据基础。在实际的数据挖掘项目中，数据准备阶段的工作往往占整个项目工作的50%~70%。值得高兴的是，假如用户在商业理解及数据理解阶段投了足够多的精力，将能有效地减少在此阶段不必要的返工。在数据准备阶段，需要完成以下工作:

  - 选择数据

  - 清理数据
  - 构建新数据
  - 集成数据
  - 格式化数据

- 建立模型

  建立模型是整个数据挖据项目中的核心阶段，通过前面的数据准备，用户已经获得可用于数据建模的高质量数据，接下来就是通过构建合适的模型从数据中获得真正的润察。在建立模型阶段，可能会需要进行多次迭代，以找到- 个能够圆满解决商业问题的模型。在建立模型阶段，需要完成以下工作:

  - 选择建模技术
  - 生成测试设计
  - 构建模型
  - 评估模型

- 模型评估

  模型评估是验证用户的工作是否获得成功的关键。在此阶段，除了需要对算法模型进行技术上的评估外，还需要根据在业务理解阶段设定的目标进行业务评估，以确保项目成果能满足实际的业务需求。在模型评估阶段，需要完成以下工作:

  - 评估结果
  - 审核过程
  - 确定后续步骤

- 结果部署

  结果部署是最终结果的运用过程。在此阶段，需要把在数据中获得的洞察应用到具体业务中，以求实现最终的商业价值。在结果部署阶段，需要完成以下工作:

  - 指定部署计划
  - 计划监视和维护
  - 生成最终报告
  - 执行最终项目审核

# 2：数据读取

## 2.1 数据类型

### 2.1.1 变量的存储类型

### 2.1.3 变量的角色

- 输入：数据的输入，也称为自变量
- 目标：属鸡的输出，也称为因变量
- 任意：只适用于关联规则算法，其他算法节点将忽略此字段
- 无：忽略的字段
- 分区：用于标记数据是属于训练集还是测试集。该字段只能具有2/3个可能值，第一个表示训练样本，第二个表示测试样本，第三个表示验证样本
- 拆分：仅分类（标记、名义、有序）字段能够被设置成拆分，SPSS Modeler会为该字段的没一个可能值建立一个模型
- 频率：用作记录的频率权重因子
- 记录标识：记录的id，用于记录样本的标记

## 2.2数据读取

数据读取在源节点上。

![image-20230102223113488](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102223113488.png)

### 2.2.1 读取excel

![image-20230102223313909](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102223313909.png)

#### 2.2.1.1 数据

- 文件类型：即excel 文件的格式
- 导入文件：导入excel 文件的地址
- 使用指定的范围：
- 选择工作表：
  - 按索引：按照索引的角度选择工作表
  - 按名称：按照工作表名称的角色选择工作表
- 工作表范围：
- 对于空行：空行的处理方式，默认停止读取
- 第一行存在列名称：第一行作为列明

#### 2.2.1.2 过滤器

![image-20230102224820301](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102224820301.png)

#### 2.2.1.3 类型

![image-20230102224854408](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102224854408.png)

#### 2.2.1.3 注解

![image-20230102224914782](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102224914782.png)

- 名称：该节点的名称
- 工具提示文本：
- 关键字：
- 说明文本：节点的说明

### 2.2.2 读取变量文件

格式为csv、txt文件的的读取

#### 2.2.2.1 文件

![image-20230102225350756](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102225350756.png)

- 文件：文件地址
- 从文件读取字段名：第一行字段的名称
- 指定字段数：选定多少字段数
- 跳过标题字符：忽略第一个记录前的多少个起始字符
- EOL注解字符：指定注释字符，用与读取时字符被忽略
- 无效字符：为空字符串或编码不存在的字符
- 编码：文本编码格式，默认utf-8
- 小数字符：
- 行定界符是转行字符：新的记录换行，非字段分隔的识别
- 自动识别日期和时间：
- 将方括号作为列表处理：将方括号所有内容识别为一个值，处理地理类型的数据可使用该设置
- 字段定界符：字段分割个识别
- 引号：单、双引号的处理方式

#### 2.2.2.2 数据

![image-20230102230416691](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102230416691.png)

#### 2.2.2.3 过滤器

同2.2.1.2

#### 2.2.2.4 类型

同2.2.1.3

#### 2.2.2.5 注解

同2.2.1.4

### 2.2.3 读取spss（.sav）文件

#### 2.2.3.1 数据

![image-20230102230740728](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230102230740728.png)

- 导入文件：文件地址
- 文件经过密码加密：文件密码
- 变量名：
- 值：
- 使用字段格式信息确定存储类型：

#### 2.2.3.2 过滤器

同2.2.1.2

#### 2.2.3.3 类型

同2.2.1.3

#### 2.2.3.4 注解

同2.2.1.4

### 2.2.4 读取数据文件（mysql）

[SPSS -MYSQL 配置]: https://mp.weixin.qq.com/s/ZwIkIJTNBP5LoQgvxTNgPQ



# 3：数据整理-数据的基本设定与集成

## 3.1 字段

- 类型功能

  数据的身份，包含存储类型、测量级别以及角色，modeler在读取数据的阶段，变量分为3个状态：非实例化、半实例化、实例化。

  - 数据的状态
    - 非实例化：当变量的存储类型、取值范围均未知时，为非实例化；测量级别显示为默认值

    - 半实例化：当变量的存储类型已知、取值范围均未知时，为半实例化；测量级别显示为连续或分类
    - 非实例化：当变量的存储类型、取值范围均已知时，为实例化；测量级别显示为连续、标记、名义、有序

  - 变量的修改

    - 修改存储类型
      - 通过填充阶段的转换函数进行修改
    - 修改测量和角色
      - 类型节点
      - 类型选项卡中定义

- 过滤器功能

  当读取数据以及设定好字段的测量级别和角色后，需要对数据进行进一步的处理。可以使用过滤器节点

  提供的功能：删除字段、重命名字段、匿名化字段等

## 3.2 数据集成

在数据挖掘当中往往需要从多个不同的数据源抽取数据，就需要对数据进行记录集成和字段集成

记录集成：追加记录，数据标哥纵向追加行记录的过程

字段集成：将多个表按照关键字对列进行合并

- 追加节点：

  - 输入选项

    ![image-20230103225835748](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230103225835748.png)

    - 标记：数据源的标记号，
    - 源节点：要追加数据源节点的名称
    - 连接的节点：与追加节点相连接的节点名称
    - 字段：不同数据源中流程追加节点的字段数量
    - 查看当前标记：显示当前数据流中已与该节点相连接的数据源
    - 查看未使用的标记位置：显示当前数据流中存在，但为与该追加节点相连的数据源

  - 追加选项

    ![image-20230103230535593](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230103230535593.png)

    - 字段匹配依据：数据集成关系到不同数据表之间变量字段的对应关系，字段匹配依据是选择这些字段间匹配的方法.
      - 位置：根据数据表中的位置进行一一对应
      - 名称：根据数据表当中的名称进行一一对应
      - 匹配观测值：启用大小写区分
    - 包含字段来源：
      - 选择仅主数据，代表追加集成后的数据集只包含主数据的字段
      - 选择所有数据集，代表表格中的素有的字段都会输出
    - 通过字段中包含源数据集来标记记录：选择此项，会向最终的数据集合增加一列，表示每个记录的数据来源，默认变量名为输入

- 合并节点

  - 合并

    ![image-20230103231352072](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230103231352072.png)

    - 合并方法：

      - 顺序：按照表格中的顺序追条合并
      - 关键字：当两个表格中的关键字段取值一致的时才进行合并。
      - 条件：指定字段映射的处理方式（如表格1中为id 表格2中为userId，可以使用条件id=userId）
      - 排名条件：除使用条件合并外，提供合并排序

    - 可用的关键字：使用关键字合并的时候，显示所有可用于合并的关键字

    - 用于合并的关键字：从可用的关键字中选择作为最终合并的关键字

    - 合并重复的关键字段：使用关键字合并时，会存在同名的关键字段。需要最终只输出一个关键字段，选择此项功能，否则，需要在过滤器选项卡中对重复的字段进度删除或重命名

    - 连接类型：（以表格1中id为1，2，3，表格2中id为1，3，4说明）

      - 仅包含匹配的记录（内部连接）：只合并不同数据源中关键字取值一样的记录，不能匹配的数据将被删除（示例数据合并后将保留id为1，3的数据）
      - 包含匹配的集合和不匹配的记录（完全外部连接）：合并不太表中所有的记录（示例数据合并后将保留id为1，2，3，4的数据）
      - 包含匹配的记录和秀and的不匹配记录（部分外部连接）：进对主表的所有记录都进行保留，副表只保留能和主表匹配的记录（示例数据合并后将保留id为1，2，3的数据）
      - 包含第一个数据集中与任何其他记录都不匹配的记录（反连接）：包含主数据中不予其他任何副表格匹配的记录（示例数据合并后将保留id为2的数据）

      总结如下：A集合为表1数据，B集合为表2数据

      - 内部连接：A&B
      - 完全外部连接：A|B
      - 部分外部连接：A
      - 反连接：A&!B

      

      

# 4：数据整理-行的处理

![image-20230105173557131](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105173557131.png)

## 4.1 选择功能

在数据整理过程中，需要根据不同的条件选择样本数据，这时就需要使用“选择”节点

![image-20230105173051314](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105173051314.png)

- 设置
  - 模式
    - 包括-满足条件的数据保留
    - 丢弃-满足条件的数据丢弃
  - 条件
    - 条件表达式
- 注解-与前述注解含义一致

## 4.2 数据排序



![image-20230105173424735](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105173424735.png)

- 设置
  - 排序方式
    - 字段 指定的字段进行升序、降序
- 优化 可设置排序前的数据的指定字段顺序
- 注解

## 4.3 数据区分

在数据中出现重新记录的出现，就会影响对应的分析结果，因此需要去除重复的记录数据。“区分”就可以实现此功能，此功能类似于sql 中的distinct

![image-20230105175241373](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105175241373.png)

- 设置
  - 模式
    - 字段 指定的字段进行升序、降序
- 组合
  - 每组仅包含首个记录
  - 为每组创建组合记录
  - 每组仅丢弃首个记录
- 优化 可设置排序前的数据的指定字段顺序
- 注解



## 4.4 数据汇总

当需要对数据进行汇总，进行数据统计的时候，可以使用“汇总”节点，以统计 平均值、最小值、最大值、标准差、中位数、计数、方差、第一个四分位、第三个四分位等

![image-20230105212809016](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105212809016.png)

- 设置
  - 关键字段，汇总的维度 即sql 中的group by
  - 汇总字段 要对那个字段进行汇总
  - 汇总表达式 通过公式将某几个字段进行汇总处理如 sum（a+b+c）
- 优化
- 注解



# 5：数据整理-列的处理

![image-20230105213229467](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105213229467.png)

## 5.1 导出

在数据处理的过程中，很多时候不使用原始指标，需要衍生出一些指标，就可以使用“导出”节点进行实现

![image-20230105213850680](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105213850680.png)

- 设置

  - 模式

    - 单个 只导出一个字段
    - 多个 导出多个字段

  - 导出字段 导出字段的名称

  - 导出为 

    - 公式

      - 按照公式的方式导出对应的字段

    - 标记

      - 导出为标记字段，通过满足公式的方式谁在对应标记值 如满足为true 值为T false 值为F

        ![image-20230105215230235](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105215230235.png)

    - 名义

      - 导出为名义字段，客诉不同的条件来生成“名义”字段的值，如可以通过年龄条件，将其转换为少年（age<=17）、青年（30>=age>17）、中年（65>=age>30）、老年（age>65）

        ![image-20230105215301953](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105215301953.png)

    - 状态

      - 生成的字段为“状态”类型。有两种状态，为“开”和“关”

        ![image-20230105215155324](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105215155324.png)

    - 计数

      - 生成的字段按条件计算。

        ![image-20230105215345010](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105215345010.png)

    - 条件

      - 满足条件A则为B，否则为C

        ![image-20230105215525486](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105215525486.png)

  - 字段类型

  - 公式

- 注解

## 5.2 填充

对字段内容进行填充，可以是针对空白值或缺失值进行填充。也可以根据某一个条件对字段内容进行填充，甚至对已有值进行转换后填充。

![image-20230105220103104](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105220103104.png)

- 设置
  - 填入字段
  - 替换
    - 根据以下条件：满足条件的才填充
    - 始终：对所有指进行填充
    - 空白值：针对空白值进行填充
    - 空值：针对空值进行填充
    - 空白值和空值：针对空白值和空值进行填充
  - 条件
  - 替换为
- 注解

## 5.3 重新分类

“重新分类”节点，主要是针对分类分类型指标对类型对类型的内容进行重新组合

![image-20230105222233553](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105222233553.png)

- 设置

  - 模式
    - 单个：针对一个指标进行重新分类
    - 多个：针对多个指标进行重新分类，即可将多个指标的内容进行整合重组
  - 重新分类为
    - 新字段：生成新的字段
    - 现有字段：填充到原始字段

- 重新分类字段：需要分类的字段

- 新字段名：新的字段

- 重新分类值

  - 获取
  - 复制
  - 清除新值
  - 自动

  

## 5.4 匿名化

在数据分析过程中，有些数据涉及保密性，比较敏感，要通过脱敏之后才显示出来，这时“匿名化”节点就可以实现简单的脱敏功能

![image-20230105223501233](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105223501233.png)

- 过滤器

- 设置

  ![image-20230105225338753](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105225338753.png)

- 匿名化值

  ![image-20230105225412195](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230105225412195.png)

- 注解



## 5.4 分级化

在spss moderler 中 “分级化”节点其实指的就是数据处理过程中非常常用的数值离散化处理。离散化是指把连续型数据切分为若干“段”，也称bin，是数据分析中常用的手段，切分的原则有等距、等频、优化，或根据数据特点而定。在数据挖掘中，离散化实用性也很强，主要有以下几点：

1. 算法需要

   如决策树、NaiveBayes 等算法本身不能直接使用连续型变量，连续型数据只有进离散处理后才能进入算法引擎，SPSS Modeler可以处理任何形式的数据，是因为SPSS Modeler 内封装了离散化处理程序

2. 性能提升

   如果建设字段元素（值）数量，算法（如多项Logistic）的性能会有所提升

3. 可以有效地客服数据中隐藏的缺陷，使模型结果更加稳定。

   如数据中的极端值是影响模型效果的一个重要因素。极端值导致模型参数过高或过低。或导致模型被虚假现象“迷惑”，把原来不存在的关系作为重要模式来学习，离散化后可以避免这种情况出现。

4. 数据隐私

   敏感类个人信息（如工资）可采用范围的报告形式，而不使用实际工资数据，以保护个人隐私

5. 有利于对非线性关系进行诊断和描述

   对连续型数据进行离散处理后，自变量和目标变量之间的关系变得清晰化，如果两者直接是非线性关系，可以重新定义离散后变量每段的取值，如采取0、1的形式，由一个变量派生为多个哑变量，分别确定每段和目标变量的联系，这样虽然减少了模型的自由度，但是可以大大提高模型的灵活度。

   ![image-20230107222125480](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107222125480.png)

- 设置

  - 分级字段：需要分级的字段

  - 分级方法

    - 固定宽度：相当于等距相当于等距，将连续型变量的取值范围均匀划分N等份，每份的间距相等，固定宽度又分为以下两种

      - 分级宽度：按指定宽度对数值进行分割，如数据的范围为15-74，如果分级宽度为10，那么根据分割的起始值计算公式“最小值-分级宽度*0.5”，即分割的起始值为10，分级范围如下图所示

        ![image-20230107223501260](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107223501260.png)

      - 分级数：按照指定分割段数进行分割，如果同样对数据的范围为15-74，进行分级数为10的分割，起始值是最小值15，终止值是最大值74，把15-74这个范围的值进行10等分，每一段的间隔(74-15)/10=5.9，如下图所示

        ![image-20230107223849434](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107223849434.png)

    - 分位数（同等计数）：即分频，把观察点均匀分为N等分，每份内包含的观察点数相同，提供了常见的“四分位数”，“五分位数”，“十分位数”，“二十分位数”，“百分位数”，以及"定制N"

      ![image-20230107224313174](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107224313174.png)

      - 分位数名称拓展：常见5种分位数离散化后的字段名命名规则
      - 定制分位数拓展：“定制N”离散化后的字段命名规则
      - 分位数：
      - 分位方法：用于指定分级分配记录的方法，如果选择“记录计数”，尽量为每个分级分配相等数量的记录；如果现在“值的和”，会尽量使每个分级中值的总和相等
      - 结：当分割点两侧的值相对时，将产生结条件。解决结的方法如下
        - 添加到下一个：将结值上移至下一个分级
        - 处于最新状态：将值保留在当前（较低）分级中，此方法可能减少创建的分级总数
        - 随机指定：将数据随机分配至一个分级，这将试图使没一个分级中的记录数量相等

    - 等级：这是以排序顺序作为离散化的方法，可选择升序或者降序，可以作为对数据做重新归一化的一种方式

      ![image-20230107225547620](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107225547620.png)

      - 序：将按照上面指定的升序或者降序对观测值进行排序。新字段中的值范围将是1-N，其中N是原始字段中离散值的数目
      - 分级排序：将对观测值进行排序，其中新字段的值等于排序值除以分缺失观测值的权重和。分数排序值介于0-1
      - 百分比分数排序：每个排序值除以具有有效数据的记录数再乘以100.分数排序值介于0-100

    - 平均值/标准差：此方法是根据数数值的分布，按照平均值加减N倍标准差的方式来分割（N可以是1、2、3）

      ![image-20230107230049316](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107230049316.png)

      如，选择+/-1 的标准差，那么他会自动计算“平均差-标准差”，“平均差+标准差”，作为阈值，切分为3段，在分级值面板会得到计算结果

      ![image-20230107230316561](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107230316561.png)

      ![image-20230107230402519](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107230402519.png)

    - 最优：自动计算最优分割方式，最优的计算与选择的“主管字段”有关系，“主管字段”一般是分类型的目标值，如果是离散化的数值与该分类目标值相关性高（强关联），那么会尽量保留两个字段间的原始关联强度创建分箱，另外，并不是每个“主管字段”都会生成分箱结果，因为二者的关联性不高

      ![image-20230107230805612](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107230805612.png)

      ![image-20230107231619625](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107231619625.png)

      - 对字段进行预预分级以使用大数据集改进性能：在大数据集计算的时候考虑使用，会牺牲一定的精度以换取速度，改方法会采用简单的非监督式分级方法将尺度值分组为大量分级，以均值表示每个分级中的值，并在继续简单式分级之前对观测值权重进行相应的调整

      - 用观测值计算较大的分级合并观测值计算相对较小的相邻分级：当该分级大小（观测值的个数）与相邻分级大小的比值小于指定的阈值时，将合并分级，注意，阈值越大，合并的分级越多

      - 剪切点设置：主要用于分割是阈值的包含关系

        ![image-20230107231751033](http://cdn.luluwanlong.cn/spss-modeler-1-5-image-20230107231751033.png)

  - 分级阈值

    - 始终计算
    - 如果可以，从分级值选项卡开始

- 分级值

- 注释

